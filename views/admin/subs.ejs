<%- include('../partials/header', { title: 'Subs - Admin - Bright Prodigy' }) %>
<div class="flex min-h-screen w-full group">
  <!-- Sidebar as sibling, not fixed -->
  <nav class="bg-blue-50 border-r border-blue-200 w-16 group-hover:w-56 transition-all duration-300 overflow-hidden z-50 sticky top-0 h-screen">
    <%- include('../partials/sidebar', { user: typeof user !== 'undefined' ? user : null, activeTab: 'subs', noFixed: true }) %>
  </nav>
  <!-- Main content shifts with sidebar -->
  <div class="flex-1 flex flex-col transition-all duration-300 ml-16 group-hover:ml-56" style="min-width:0;">
    <%- include('../partials/topbar', { user: typeof user !== 'undefined' ? user : null, currentTab: 'Subs' }) %>
    <div class="flex flex-row h-[calc(100vh-4rem)]">
      <!-- Sub-Tabs Vertical Sidebar (no ml-16 needed) -->
      <nav aria-label="Sub stages" class="subtabs-nav sticky top-16 h-[calc(100vh-4rem)] overflow-y-auto z-40">
        <% const tabList = ['All Subs', 'Not Contacted Yet', 'Contacted', 'Waiting Cust Approval', 'Confirmed & Inputted', 'Not Interested after sub', 'Bad Lead', 'Contacted again, no reply', 'Fired']; %>
        <ul>
          <% tabList.forEach(tab => { %>
            <li>
              <a
                href="/admin/subs?<%= tab === 'All Subs' ? '' : 'stage=' + encodeURIComponent(tab) %>"
                class="block py-2 rounded-md font-medium transition-colors text-blue-700 hover:bg-blue-50 focus:bg-blue-100 <%= currentStage === tab ? 'bg-blue-100' : '' %>"
                aria-current="<%= currentStage === tab ? 'page' : undefined %>"
              >
                <%= tab %>
              </a>
            </li>
          <% }) %>
        </ul>
      </nav>
      <!-- Main content: table to the right of sub-tabs, fills remaining space -->
      <div class="flex-1 min-w-0 flex flex-col">
        <h1 class="text-2xl font-bold mb-4 px-6 pt-6">Subs</h1>
        <div class="flex-1 min-h-0 overflow-auto px-6 pb-6">
          <% const hasRows = rows && rows.length > 0; %>
          <div class="overflow-x-auto w-full">
            <table class="table-auto divide-y divide-gray-200 min-w-full">
              <thead class="bg-blue-100 sticky top-0 z-10">
                <tr>
                  <% if (hasRows) { Object.keys(rows[0]).forEach(col => { %>
                    <th class="px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider bg-blue-100 whitespace-nowrap">
                      <%= col %>
                    </th>
                  <% }) } %>
                </tr>
              </thead>
              <tbody>
                <% if (hasRows) { %>
                  <% rows.forEach((row, idx) => { %>
                    <tr class="<%= idx % 2 === 0 ? 'bg-white' : 'bg-blue-100' %>">
                      <% Object.values(row).forEach(val => { %>
                        <td class="px-4 py-2 text-sm text-gray-900 whitespace-nowrap"><%= val %></td>
                      <% }) %>
                    </tr>
                  <% }) %>
                <% } else { %>
                  <tr>
                    <td colspan="100" class="text-center py-8 text-gray-400">No submissions found.</td>
                  </tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <%- include('../partials/footer') %>
  </div>
</div>
