<%- include('../partials/header', { title: 'Subs - Admin - Bright Prodigy' }) %>
<div class="layout-grid">
  <%- include('../partials/sidebar', { user: typeof user !== 'undefined' ? user : null, activeTab: 'subs' }) %>
  <div style="width:100%">
    <%- include('../partials/topbar', { user: typeof user !== 'undefined' ? user : null, currentTab: 'Subs' }) %>
  <!-- Sub-tabs navigation: pill-style, responsive, horizontal scrollable -->
  <div class="tabs flex flex-nowrap gap-2 overflow-x-auto py-3 px-6 bg-white border-b border-blue-100 sticky top-16 z-30">
    <% if (stages && stages.length) { %>
      <% stages.forEach(stage => { %>
        <a
          href="/admin/subs?<%= stage === 'Not Contacted Yet' ? '' : 'stage=' + encodeURIComponent(stage) %>"
          class="px-5 py-2 rounded-full text-sm font-semibold whitespace-nowrap transition-all duration-150
            <%= currentStage === stage
              ? 'bg-blue-500 text-white shadow'
              : 'bg-blue-100 text-blue-700 hover:bg-blue-200 focus:bg-blue-200' %>">
          <%= stage %>
        </a>
      <% }) %>
    <% } %>
  </div>
  <!-- Main content: full width, fills vertical space, table scrolls -->
  <div class="flex flex-col h-[calc(100vh-4rem)]"> <!-- 4rem = topbar height -->
    <h1 class="text-2xl font-bold mb-4 px-6 pt-6">Subs</h1>
    <div class="flex-1 min-h-0 flex flex-col">
      <div class="flex-1 min-h-0 overflow-auto px-6 pb-6">
        <table class="w-full min-w-full table-auto divide-y divide-gray-200">
          <thead class="bg-blue-100 sticky top-0 z-10">
            <tr>
              <% if (rows && rows.length > 0) { Object.keys(rows[0]).forEach(col => { %>
                <th class="px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider bg-blue-100">
                  <%= col %>
                </th>
              <% }) } %>
            </tr>
          </thead>
          <tbody>
            <% if (rows && rows.length > 0) { %>
              <% rows.forEach((row, idx) => { %>
                <tr class="<%= idx % 2 === 0 ? 'bg-white' : 'bg-blue-50' %>">
                  <% Object.values(row).forEach(val => { %>
                    <td class="px-4 py-2 text-sm text-gray-900"><%= val %></td>
                  <% }) %>
                </tr>
              <% }) %>
            <% } else { %>
              <tr>
                <td colspan="100" class="text-center py-8 text-gray-400">No submissions found.</td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <%- include('../partials/footer') %>
  </div>
</div>
