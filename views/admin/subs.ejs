<%- include('../partials/header', { title: 'Subs - Admin - Bright Prodigy' }) %>
<div class="layout-grid">
  <%- include('../partials/sidebar', { user: typeof user !== 'undefined' ? user : null, activeTab: 'subs' }) %>
  <div style="width:100%">
    <%- include('../partials/topbar', { user: typeof user !== 'undefined' ? user : null, currentTab: 'Subs' }) %>
    <div class="flex flex-row h-[calc(100vh-4rem)]">
      <!-- Sub-tabs navigation: vertical nav, styled like sidebar, to the right of sidebar -->
      <nav class="subtabs-nav flex flex-col py-2 px-0 bg-blue-50 border-r border-blue-200 w-56 min-w-[12rem] max-w-xs h-full">
        <% if (stages && stages.length) { %>
          <% stages.forEach(stage => { %>
            <a
              href="/admin/subs?<%= stage === 'Not Contacted Yet' ? '' : 'stage=' + encodeURIComponent(stage) %>"
              class="flex items-center space-x-2 px-6 py-2 text-blue-700 hover:bg-blue-100 transition-all duration-200 text-base font-medium
                <%= currentStage === stage
                  ? 'bg-blue-100 shadow-md border-l-4 border-blue-500'
                  : '' %>">
              <span><%= stage %></span>
            </a>
          <% }) %>
        <% } %>
      </nav>
      <!-- Main content: table to the right of sub-tabs, fills remaining space -->
      <div class="flex-1 min-w-0 flex flex-col">
        <h1 class="text-2xl font-bold mb-4 px-6 pt-6">Subs</h1>
        <div class="flex-1 min-h-0 overflow-auto px-6 pb-6">
          <table class="table-auto divide-y divide-gray-200">
            <thead class="bg-blue-100 sticky top-0 z-10">
              <tr>
                <% if (rows && rows.length > 0) { Object.keys(rows[0]).forEach(col => { %>
                  <th class="px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider bg-blue-100 whitespace-nowrap">
                    <%= col %>
                  </th>
                <% }) } %>
              </tr>
            </thead>
            <tbody>
              <% if (rows && rows.length > 0) { %>
                <% rows.forEach((row, idx) => { %>
                  <tr class="<%= idx % 2 === 0 ? 'bg-white' : 'bg-blue-100' %>">
                    <% Object.values(row).forEach(val => { %>
                      <td class="px-4 py-2 text-sm text-gray-900 whitespace-nowrap"><%= val %></td>
                    <% }) %>
                  </tr>
                <% }) %>
              <% } else { %>
                <tr>
                  <td colspan="100" class="text-center py-8 text-gray-400">No submissions found.</td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <%- include('../partials/footer') %>
  </div>
</div>
